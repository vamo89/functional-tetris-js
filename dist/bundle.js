!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const r=n(1),i=x("tetris-canvas"),o=document.getElementById("points"),c=document.getElementById("level"),a=x("tetris-nextPiece-canvas");let l;function u(e=!1){!function(e){i.fillStyle="green",i.fillRect(1,7,10,4),i.fillStyle="black",i.font="3px times",e?i.fillText("Restart",2,10):i.fillText("Start",3,10)}(e),i.canvas.addEventListener("click",p)}function x(e){const t=document.getElementById(e).getContext("2d");return t.scale(20,20),t.font="1px times",t}function y(e){l=r.userEvent(l,e.code),s(i,l)}function p(){const e=+new Date;l=r.initalState(12,20,e,{nextPieceMaxWidth:3,nextPieceMaxHeight:4}),i.canvas.removeEventListener("click",p),document.addEventListener("keydown",y),f()}function f(e=0){l=r.tick(l,e),s(i,l),l.continue?window.requestAnimationFrame(f):(document.removeEventListener("keydown",y),u(!0))}function s(e,t){var n,r;function i(e,t){t.forEach((t,n)=>t.forEach((t,r)=>{t&&(e.fillStyle=["","cyan","blue","orange","yellow","lime","purple","red"][t],e.fillRect(r,n,1,1))}))}e.clearRect(0,0,12,20),i(e,t.player.matrix),n=t.player.points,o.innerText="Points: "+n,r=t.player.level,c.innerText="Level: "+r,a.clearRect(0,0,3,4),i(a,t.player.nextPiece.matrix)}u()},function(e,t,n){e.exports={initalState:function(e,t,n,o){return r.init(n),{continue:!0,player:{matrix:i(e,t),points:0,level:0,piecePos:{x:0,y:5},piece:b(),nextPiece:function(e){if(e){const t=b();return{piece:t,matrix:p(t,e.nextPieceMaxWidth,e.nextPieceMaxHeight),matrixWidth:e.nextPieceMaxWidth,matrixHeight:e.nextPieceMaxHeight}}}(o),pieceRotation:0},timeControl:{dropInterval:200,lastDrop:0}}},userEvent:function(e,t){if("ArrowUp"===t)e.player=o(e.player);else{const n={ArrowLeft:"L",ArrowRight:"R",ArrowDown:"D"}[t];R(e.player,n)||(e.player=S(e.player,n))}return e},tick:function(e,t){const n=_(e);if(t-e.timeControl.lastDrop<=e.timeControl.dropInterval)return n;if(n.timeControl.lastDrop=t,R(n.player,"D")){if(c(n.player.matrix)){const e=a(n.player.matrix);if(void 0===e)return console.log("roundPoints undefined"),n.continue=!1,n;n.player.points+=e,n.player.matrix=x(n.player.matrix),n.player.level=l(n.player.points),n.timeControl.dropInterval=u(n.player.level)}if(n.player.piecePos={x:0,y:5},n.player.nextPiece){const e=n.player.nextPiece;n.player.piece=e.piece,e.piece=b(),e.matrix=p(e.piece,e.matrixWidth,e.matrixHeight)}else n.player.piece=b();if(n.player.pieceRotation=0,R(n.player,"",!1))return console.log("END GAME"),n.continue=!1,n;n.player.matrix=y(n.player.matrix,n.player.piece)}else n.player=S(n.player,"D");return n},_rotate:o,_clearMatrix:i,_removeCompleteLines:x,_calculatePointsForLineCompletion:a,_checkLineComplete:c,_createNewPiece:y,_move:S,_collision:R,_calculateLevel:l,_calculateDropInterval:u};const r=n(2);function i(e=12,t=20){return Array.from(Array(t),()=>Array.from(Array(e),()=>0))}function o(e){const t=_(e);return t.pieceRotation=3===t.pieceRotation?0:t.pieceRotation+1,t.matrix=g(t.matrix,t.piece,t.piecePos,e.pieceRotation),t.matrix=P(t.matrix,t.piece,t.piecePos,t.pieceRotation),function(e,t){return n(e)!==n(t);function n(e){return e.reduce((e,t)=>e+t.reduce((e,t)=>e+t,0),0)}}(e.matrix,t.matrix)?e:t}function c(e){return e.some(e=>f(e))}function a(e){return[0,40,100,300,1200][function(e){return e.filter(f).length}(e)]}function l(e){return Math.floor(e/200)}function u(e){return Math.max(e<=5?200-20*e:100-10*(e-5),50)}function x(e){const t=e.filter(e=>!f(e));for(;t.length<e.length;)t.unshift(s(e[0].length));return t}function y(e,t,n={x:0,y:5}){return P(e,t,n,0)}function p(e,t,n){return y(i(t,n),e,{x:0,y:0})}function f(e){return e.every(e=>e>0)}function s(e=12){return new Array(e).fill(0)}function m(e){return["","I","J","L","O","S","T","Z"].indexOf(e)}function d(e,t,n,r,i){const o=r(t);return v(e,t,n,i,(e,t,n)=>{e[t]&&void 0!==e[t][n]&&(e[t][n]=o)})}function v(e,t,n,r,i){var o=_(e);switch(t){case"I":r%2?(i(o,n.x+1,n.y-1),i(o,n.x+1,n.y),i(o,n.x+1,n.y+1),i(o,n.x+1,n.y+2)):(i(o,n.x,n.y),i(o,n.x+1,n.y),i(o,n.x+2,n.y),i(o,n.x+3,n.y));break;case"J":r%2?(i(o,n.x+1,n.y),i(o,n.x+1,n.y+1),i(o,n.x+1,n.y+2),1===r?i(o,n.x,n.y):i(o,n.x+2,n.y+2)):(i(o,n.x,n.y+1),i(o,n.x+1,n.y+1),i(o,n.x+2,n.y+1),0===r?i(o,n.x+2,n.y):i(o,n.x,n.y+2));break;case"L":r%2?(i(o,n.x+1,n.y-1),i(o,n.x+1,n.y),i(o,n.x+1,n.y+1),1===r?i(o,n.x+2,n.y-1):i(o,n.x,n.y+1)):(i(o,n.x,n.y),i(o,n.x+1,n.y),i(o,n.x+2,n.y),0===r?i(o,n.x+2,n.y+1):i(o,n.x,n.y-1));break;case"O":i(o,n.x,n.y),i(o,n.x+1,n.y),i(o,n.x,n.y+1),i(o,n.x+1,n.y+1);break;case"S":r%2?(i(o,n.x-1,n.y),i(o,n.x,n.y),i(o,n.x,n.y+1),i(o,n.x+1,n.y+1)):(i(o,n.x,n.y+1),i(o,n.x,n.y+2),i(o,n.x+1,n.y+1),i(o,n.x+1,n.y));break;case"T":r%2?(i(o,n.x,n.y+1),i(o,n.x+1,n.y+1),i(o,n.x-1,n.y+1),i(o,n.x,1===r?n.y:n.y+2)):(i(o,n.x,n.y+1),i(o,n.x,n.y+2),i(o,n.x,n.y),i(o,0===r?n.x+1:n.x-1,n.y+1));break;case"Z":r%2?(i(o,n.x-1,n.y+1),i(o,n.x,n.y+1),i(o,n.x,n.y),i(o,n.x+1,n.y)):(i(o,n.x,n.y),i(o,n.x,n.y+1),i(o,n.x+1,n.y+1),i(o,n.x+1,n.y+2))}return o}function P(e,t,n,r){return d(e,t,n,m,r)}function g(e,t,n,r){return d(e,t,n,()=>0,r)}function h(e,t){return{x:e.x+function(e){return"D"===e?1:0}(t),y:e.y+function(e){return("R"===e?1:0)-("L"===e?1:0)}(t)}}function b(){return["I","J","L","O","S","T","Z"][r.next(0,6)]}function R(e,t,n=!0){let r=e.matrix;n&&(r=g(e.matrix,e.piece,e.piecePos,e.pieceRotation));let i=!1;return v(r,e.piece,h(e.piecePos,t),e.pieceRotation,(e,t,n)=>{i=i||void 0===e[t]||void 0===e[t][n]||e[t][n]}),!!i}function S(e,t){return function(e,t){const n=_(e);return n.piecePos=t,n.matrix=g(n.matrix,n.piece,e.piecePos,n.pieceRotation),n.matrix=P(n.matrix,n.piece,n.piecePos,n.pieceRotation),n}(e,h(e.piecePos,t))}function _(e){return JSON.parse(JSON.stringify(e))}},function(e,t){e.exports={init:function(e){n=e},next:function(e,t){return n=16807*n%2147483647,n%(t-e)+e}};let n=0}]);